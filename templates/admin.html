<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<div class="admin-container">

<!-- ========================================================= -->
<!-- ======= MODULE 0: TIÃŠU Äá»€ + THÃ”NG BÃO Há»† THá»NG ============ -->
<!-- ========================================================= -->

<h2>âš™ ADMIN DASHBOARD</h2>

{% for c, m in get_flashed_messages(with_categories=true) %}
  <div class="flash {{ c }}">{{ m }}</div>
{% endfor %}


<div class="admin-card">

<h3>ğŸ“¥ Upload Ä‘á» </h3>

<form method="post">
  <!-- XÃC Äá»ŠNH ACTION CHO BACKEND -->
  <input type="hidden" name="action" value="bulk_upload">

  <!-- ======= CHá»ŒN MÃ”N ======= -->
  <label>MÃ´n</label>
  <select name="subject" id="subjectSelect" required>
    <option value="">-- Chá»n mÃ´n --</option>
    <option value="toan">ToÃ¡n</option>
    <option value="ly">LÃ½</option>
    <option value="hoa">HÃ³a</option>
    <option value="trung">Tiáº¿ng Trung</option>
  </select>

  <!-- ======= CHá»ŒN Lá»šP / HSK (Äá»”I THEO MÃ”N) ======= -->
  <label>Lá»›p / HSK</label>
  <select name="class_name" id="classSelect" required></select>

  <label>â± Thá»i gian lÃ m bÃ i (phÃºt)</label>
<input type="number" name="time_limit" value="15" min="1" required>

  <label>ğŸ“˜ TÃªn Ä‘á» </label>
<input type="text" name="quiz_name" required placeholder="VD: HÃ³a há»c â€“ CÆ¡ báº£n">

  <!-- ======= PASTE CÃ‚U Há»I ======= -->
<!-- FORMAT: question<TAB>A<TAB>B<TAB>C<TAB>D<TAB>correct -->
<textarea
    name="bulk_text"
    rows="10"
    placeholder="question<TAB>A<TAB>B<TAB>C<TAB>D<TAB>correct"
    required></textarea>

  <button class="btn btn-primary">ğŸš€ Upload</button>
</form>

</div>

 <!-- ===== FILTER Äá»€ THEO MÃ”N & Lá»šP (LV1) ===== -->
<div style="display:flex; gap:12px; margin-bottom:12px; align-items:center">

  <label><b>MÃ´n:</b></label>
  <select id="filterSubject">
    <option value="all">-- Táº¥t cáº£ --</option>
    <option value="toan">ToÃ¡n</option>
    <option value="ly">LÃ½</option>
    <option value="hoa">HÃ³a</option>
    <option value="trung">Tiáº¿ng Trung</option>
  </select>

  <label><b>Lá»›p / HSK:</b></label>
  <select id="filterClass">
    <option value="all">-- Táº¥t cáº£ --</option>
  </select>

</div>


<!-- ========================================================= -->
<!-- ======= MODULE 1: DANH SÃCH Táº¤T Cáº¢ Äá»€ TRONG Há»† THá»NG ====== -->
<!-- ======= Xem / Chá»n / XoÃ¡ Ä‘á» ============================= -->
<!-- ========================================================= -->

<div class="admin-card">

<h3>ğŸ“š Danh sÃ¡ch Ä‘á»</h3>

<table id="quizTable">
  <thead>
    <tr>
      <th>MÃ´n</th>
      <th>Lá»›p</th>
      <th>TÃªn Ä‘á»</th>
      <th>â± Thá»i gian (phÃºt)</th>
      <th>HÃ nh Ä‘á»™ng</th>
    </tr>
  </thead>

  <tbody>
  {% for q in quizzes %}
    <tr>
      <td>{{ q.subject }}</td>
<td>{{ q.class }}</td>
<td>{{ q.quiz_name }}</td>


      <!-- ===== Cá»˜T Sá»¬A THá»œI GIAN ===== -->
      <td>
        <form method="post" style="display:flex; gap:6px; align-items:center">
          <input type="hidden" name="action" value="update_time">
          <input type="hidden" name="quiz_id" value="{{ q.quiz_id }}">
          <input type="number"
                 name="time_limit"
                 value="{{ q.time_limit or 15 }}"
                 min="1"
                 style="width:70px">
          <button class="btn btn-primary">ğŸ’¾</button>
        </form>
      </td>

      <!-- ===== Cá»˜T HÃ€NH Äá»˜NG ===== -->
      <td>
        <a href="/admin?subject={{ q.subject }}&quiz_id={{ q.quiz_id }}">ğŸ‘ Xem</a>
        |
        <a href="/admin/delete-quiz/{{ q.subject }}/{{ q.quiz_id }}"
           onclick="return confirm('XoÃ¡ Ä‘á» vÃ  toÃ n bá»™ cÃ¢u há»i?')">
           âŒ XoÃ¡
        </a>
      </td>
    </tr>
  {% endfor %}

  </tbody>
</table>



<!-- ========================================================= -->
<!-- ======= MODULE 2: UPLOAD Äá»€ + NHIá»€U CÃ‚U Há»I (PASTE) ======= -->
<!-- ======= Má»—i dÃ²ng = 1 cÃ¢u há»i ============================ -->
<!-- ========================================================= -->




<!-- ========================================================= -->
<!-- ======= MODULE 3: THÃ”NG TIN Äá»€ ÄANG ÄÆ¯á»¢C CHá»ŒN ============ -->
<!-- ======= Hiá»‡n khi admin báº¥m 'Xem' ======================== -->
<!-- ========================================================= -->

{% if selected_quiz %}
<div class="admin-card">

<h3>ğŸ—‚ Äá» Ä‘ang chá»n</h3>

<p><b>Quiz ID:</b> {{ selected_quiz }}</p>

<form method="post">
  <input type="hidden" name="action" value="delete_quiz">
  <input type="hidden" name="subject" value="{{ selected_subject }}">
  <input type="hidden" name="quiz_id" value="{{ selected_quiz }}">
  <button class="btn btn-danger"
          onclick="return confirm('XoÃ¡ Ä‘á» vÃ  toÃ n bá»™ cÃ¢u há»i?')">
    âŒ XoÃ¡ Ä‘á» nÃ y
  </button>
</form>

</div>
{% endif %}


<!-- ========================================================= -->
<!-- ======= MODULE 4: DANH SÃCH CÃ‚U Há»I TRONG Äá»€ ============= -->
<!-- ======= Xem ná»™i dung + XoÃ¡ tá»«ng cÃ¢u ==================== -->
<!-- ========================================================= -->

<div class="admin-card">

<h3>ğŸ“‹ CÃ¢u há»i trong Ä‘á»</h3>

{% if questions %}
  {% for q in questions %}
    <div class="question-item">
      <b>{{ loop.index }}.</b> {{ q.question }}

      <ul>
        <li>A. {{ q.answer_A }}</li>
        <li>B. {{ q.answer_B }}</li>
        <li>C. {{ q.answer_C }}</li>
        <li>D. {{ q.answer_D }}</li>
        <li><b>âœ” ÄÃ¡p Ã¡n Ä‘Ãºng: {{ q.correct_answer }}</b></li>
      </ul>

      <!-- XOÃ 1 CÃ‚U Há»I -->
      <form method="post">
        <input type="hidden" name="action" value="delete_question">
        <input type="hidden" name="subject" value="{{ selected_subject }}">
        <input type="hidden" name="quiz_id" value="{{ selected_quiz }}">
        <input type="hidden" name="question" value="{{ q.question }}">
        <button class="btn btn-danger"
                onclick="return confirm('XoÃ¡ cÃ¢u há»i nÃ y?')">
          âŒ XoÃ¡ cÃ¢u
        </button>
      </form>
    </div>
  {% endfor %}
{% else %}
  <p>ChÆ°a cÃ³ cÃ¢u há»i.</p>
{% endif %}

</div>

<script>
  // ===== MAP MÃ”N â†’ DANH SÃCH Lá»šP / HSK =====
  const classMap = {
    toan: ["lop 1","lop 2","lop 3","lop 4","lop 5","lop 6","lop 7","lop 8","lop 9"],
    ly:   ["lop 6","lop 7","lop 8","lop 9"],
    hoa:  ["lop 6","lop 7","lop 8","lop 9"],
    trung:["hsk 1","hsk 2","hsk 3","hsk 4","hsk 5","hsk 6","hsk 7","hsk 8","hsk 9"]
  };

  const subjectSelect = document.getElementById("subjectSelect");
  const classSelect = document.getElementById("classSelect");

  // ===== RENDER Lá»šP THEO MÃ”N =====
  function renderClasses(subject) {
    classSelect.innerHTML = "";
    if (!classMap[subject]) return;

    classMap[subject].forEach(cls => {
      const opt = document.createElement("option");
      opt.value = cls;
      opt.textContent = cls.toUpperCase();
      classSelect.appendChild(opt);
    });
  }

  // ===== KHI Äá»”I MÃ”N =====
  subjectSelect.addEventListener("change", function () {
    renderClasses(this.value);
  });

  // ===== RENDER NGAY KHI LOAD TRANG =====
  if (subjectSelect.value) {
    renderClasses(subjectSelect.value);
  }
</script>

  <script>
const filterSubject = document.getElementById("filterSubject");
const filterClass = document.getElementById("filterClass");

function renderFilterClasses(subject) {
  filterClass.innerHTML = '<option value="all">-- Táº¥t cáº£ --</option>';
  if (!classMap[subject]) return;

  classMap[subject].forEach(cls => {
    const opt = document.createElement("option");
    opt.value = cls;
    opt.textContent = cls.toUpperCase();
    filterClass.appendChild(opt);
  });
}

filterSubject.addEventListener("change", function () {
  renderFilterClasses(this.value);
});
</script>
  <script>
/* ===== Lá»ŒC DANH SÃCH Äá»€ ===== */

function applyQuizFilter() {
  const subject = filterSubject.value; // toan / ly / hoa / trung
  const cls = filterClass.value;       // lop 7 / hsk 1 / all

  const rows = document.querySelectorAll("#quizTable tbody tr");

  rows.forEach(row => {
    const rowSubject = row.children[0].innerText.trim().toLowerCase();
    const rowClass = row.children[1].innerText
      .trim()
      .toLowerCase()
      .replace("lá»›p", "lop")
      .replace(" ", "");

    let show = true;

    if (subject !== "all" && rowSubject !== subject) show = false;
    if (cls !== "all" && rowClass !== cls.replace(" ", "")) show = false;

    row.style.display = show ? "" : "none";
  });
}

filterSubject.addEventListener("change", applyQuizFilter);
filterClass.addEventListener("change", applyQuizFilter);
</script>



<!-- ========================================================= -->
<!-- ======= MODULE 5: ÄÄ‚NG XUáº¤T ============================= -->
<!-- ========================================================= -->

<a href="/logout">ğŸšª ÄÄƒng xuáº¥t</a>


<!-- ============================================
